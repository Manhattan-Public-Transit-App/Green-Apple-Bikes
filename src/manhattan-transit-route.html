<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="shared-styles.html">

<dom-module id="manhattan-transit-route">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>
    <div class="card"><paper-input id="origin" label="Starting Location"></paper-input></div>
    <div class="card"><paper-input id="destination" label="Destination"></paper-input></div>
    <br><br>
    <div class="card button-container"><paper-button id="submit" on-click="calculateRoute" raised>Determine Fastest Route</paper-button></div>
  </template>

  <script>
    Polymer({
      is: 'manhattan-transit-route',
      calculateRoute: function(e) {
		var apikey = "AIzaSyDTl1JhIHmAfin_kXUBYCnAeIkudpJypcc";
		var origin = this.$.origin.inputElement.value;
		var destination = this.$.destination.inputElement.value;
      	console.log("Origin: " + origin + "\nDestination: " + destination);
      	findRoute(origin, destination, "driving");
      }
    });
    
    
    
    
    
	function findRoute(theOrigin, theDestination, mode) {
	
		var bikeRequest = new XMLHttpRequest();
   		bikeRequest.open("GET", "http://129.130.82.141/index.php/api/getLocation", false);
   		bikeRequest.send(null)
   		var bikes = JSON.parse(bikeRequest.responseText);
		
		var availableBikes = [];
		
		bikes.forEach(function(bike) {
			if (bike.status == "Available") {
				availableBikes.push(bike);
			}
		});
		console.log(availableBikes);
	
		var theMode;
		if (mode == "driving") {
			theMode = google.maps.DirectionsTravelMode.DRIVING;
		} else if (mode == "walking") {
			theMode = google.maps.DirectionsTravelMode.WALKING;
		} else if (mode == "bicycling") {
			theMode = google.maps.DirectionsTravelMode.BICYCLING;
		}
		
		var directionsService = new google.maps.DirectionsService();
		var directionsRequest = {
			origin: theOrigin,
			destination: theDestination,
			travelMode: theMode,
			unitSystem: google.maps.UnitSystem.IMPERIAL
		};
		
		directionsService.route(directionsRequest, function (response, status) {
			if (status == google.maps.DirectionsStatus.OK) {
					console.log(response);
					alert("Origin: " + response.routes[0].legs[0].start_address + "\nDestination: " + response.routes[0].legs[0].end_address);
					console.log(response.routes[0].copyrights);
					console.log(response.routes[0].legs[0].distance.text);
					console.log(response.routes[0].legs[0].duration.text);
					response.routes[0].legs[0].steps.forEach(function(step) {
					alert(step.instructions);
				});
				console.log(response);
			} else {
				alert("Could not determine one of the locations.");
			}
		});
	}
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDTl1JhIHmAfin_kXUBYCnAeIkudpJypcc"
    async defer></script>
</dom-module>
